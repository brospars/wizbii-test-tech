"use strict";angular.module("wizbiiTechTestApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/dashboard",{templateUrl:"views/dashboard.html",controller:"DashboardCtrl",controllerAs:"dashboard"}).otherwise({redirectTo:"/"})}]),angular.module("wizbiiTechTestApp").controller("MainCtrl",["$scope","$location","wizbiiApiFactory",function(a,b,c){angular.isDefined(sessionStorage.userToken)&&angular.isDefined(sessionStorage.currentUser)&&b.path("/dashboard"),a.login=function(){""!==a.formData.login&&""!==a.formData.password&&c.login(a.formData.login,a.formData.password).success(function(a){angular.isDefined(a["access-token"])&&(sessionStorage.userToken=a["access-token"],sessionStorage.currentUser=JSON.stringify(a.profile),b.path("/dashboard"))}).error(function(a){swal("Hum..","Une erreur s'est produite","error")})}}]),angular.module("wizbiiTechTestApp").factory("wizbiiApiFactory",["$http",function(a){var b={},c="http://5.196.94.31:8080/",d="api.wizbii.com:443",e=c+d;return b.login=function(b,c){var d={method:"POST",url:e+"/v1/account/validate",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},data:{username:b,password:c,client_id:"test",grant_type:"password"}};return a(d)},b.dashboard=function(){var b={method:"POST",url:e+"/v2/dashboard/",headers:{Authorization:"Bearer "+sessionStorage.userToken},data:{direction:"newest"}};return a(b)},b}]),angular.module("wizbiiTechTestApp").controller("DashboardCtrl",["$scope","$location","$filter","wizbiiApiFactory",function(a,b,c,d){angular.isDefined(sessionStorage.userToken)&&angular.isDefined(sessionStorage.currentUser)?(d.dashboard().success(function(b){a.feedItems=b.feed_items.feed_items}).error(function(a){console.log(a)}),a.currentUser=JSON.parse(sessionStorage.currentUser)):b.path("/"),a.postComment=function(){swal("Posté!","Ton (faux) commentaire a été envoyé","success")},a.likePost=function(b){var d={date_created:(new Date).toISOString(),liker_id:a.currentUser.id,liker_type:"profile",profile:a.currentUser},e=c("filter")(a.feedItems,{id:b})[0];!c("filter")(e.publication.likes,{liker_id:a.currentUser._id}).length>0&&e.publication.likes.push(d)},a.sharePost=function(a){var b="http://wizbii.com/publication/"+a;swal({title:"Partager la publication",text:'<a href="http://twitter.com/share?url='+b+'" target="_blank" class="share-btn twitter"><i class="fa fa-twitter"></i></a><a href="https://plus.google.com/share?url='+b+'" target="_blank" class="share-btn google-plus"><i class="fa fa-google-plus"></i></a><a href="http://www.facebook.com/sharer/sharer.php?u=http://www.agori.fr/2016/05/09/le-projet-de-reforme-du-code-du-travail-en-discussion-au-parlement/" target="_blank" class="share-btn facebook"><i class="fa fa-facebook"></i></a><a href="http://www.linkedin.com/shareArticle?url='+b+'" target="_blank" class="share-btn linkedin"><i class="fa fa-linkedin"></i></a>',html:!0})},a.formatText=function(a){a=a.replace(/\n/g,"<br/>");var b=/(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/g;return a.replace(b,function(a){return'<a href="'+a+'">'+a+"</a>"})},a.getPosterAvatar=function(a){var b=a.poster_type;return"COMPANY"===b?a.company.logo:"PROFILE"===b?a.profile.avatar:""}}]),angular.module("wizbiiTechTestApp").directive("formatDate",function(){return{restrict:"E",link:function(a,b,c){var d=new Date(c.date),e=["janvier","février","mars","avril","mai","juin","juillet","aout","septembre","octobre","novembre","decembre"];b.text("le "+d.getDate()+" "+e[d.getMonth()]+" "+d.getFullYear())}}}),angular.module("wizbiiTechTestApp").controller("NavbarCtrl",["$scope","$location",function(a,b){a.logout=function(){sessionStorage.removeItem("userToken"),sessionStorage.removeItem("currentUser"),b.path("/")}}]),angular.module("wizbiiTechTestApp").run(["$templateCache",function(a){a.put("views/dashboard.html",'<div class="view-wrapper dashboard-view-wrapper"> <div class="gridster-container"> <div class="spinner" ng-if="feedItems==undefined"> <svg width="38" height="38" viewbox="0 0 39 39" xmlns="http://www.w3.org/2000/svg" stroke="#1ba3e1"> <g fill="none" fill-rule="evenodd"> <g transform="translate(1 1)" stroke-width="2"> <circle stroke-opacity=".5" cx="18" cy="18" r="18"></circle> <path d="M36 18c0-9.94-8.06-18-18-18"> <animatetransform attributename="transform" type="rotate" from="1 18 18" to="360 18 18" dur="1s" repeatcount="indefinite"> </path> </g> </g> </svg> </div> <div class="publication-item col s12" ng-repeat="feedItem in feedItems" ng-if="feedItem.publication!==undefined"> <div class="publication-header"> <img class="profile-avatar" ng-src="{{getPosterAvatar(feedItem.publication)}}"> <div class="post-info"> <div class="post-author-name"><a href="#">{{feedItem.publication.poster.displayName}}</a></div> <format-date class="post-date" date="{{feedItem.date}}"></format-date> <div class="post-author-title"></div> </div> </div> <div class="publication-body"> <ul class="post-tags"> <li ng-repeat="tag in feedItem.publication.tags">#{{tag.name}} </li> </ul> <div class="post-content" ng-bind-html="formatText(feedItem.publication.content)"></div> </div> <div class="post-attachment" ng-class="feedItem.publication.attachment_picture==undefined ? \'no-thumb\' : \'\'" ng-if="feedItem.publication.attachment_title!==undefined"> <a href="{{feedItem.publication.attachment_link}}"> <img ng-src="{{feedItem.publication.attachment_picture}}" ng-if="feedItem.publication.attachment_picture!==undefined"> <div class="post-attachment-infos"> <div class="post-attachment-title">{{feedItem.publication.attachment_title | limitTo: 40 }}{{feedItem.publication.attachment_title.length > 40 ? \'...\' : \'\'}}</div> <p>{{feedItem.publication.attachment_content | limitTo: 70 }}{{feedItem.publication.attachment_content.length > 70 ? \'...\' : \'\'}}</p> </div> </a> </div> <div class="publication-actions"> <div class="gridster-container"> <div class="col m6 s12 publication-action" ng-click="likePost(feedItem.id)"> <div class="icon-action"> <i class="fa fa-thumbs-o-up" aria-hidden="true"></i> </div> Envoyer un Thanks ! </div> <div class="col m6 s12 publication-action" ng-click="sharePost(feedItem.id)"> <div class="icon-action"> <i class="fa fa-share" aria-hidden="true"></i> </div> Partager </div> </div> </div> <div class="publication-footer" ng-init="footerMode=\'comment\'"> <div class="publication-footer-menu"> <ul class="publication-tabs"> <li ng-click="footerMode = \'comment\'" ng-class="footerMode === \'comment\' ? \'active\':\'\'"> {{feedItem.publication.comments.length}} commentaire{{feedItem.publication.comments.length > 1 ? \'s\' : \'\'}} </li> - <li ng-click="footerMode = \'like\'" ng-class="footerMode === \'like\' ? \'active\':\'\'"> {{feedItem.publication.likes.length}} thanx </li> </ul> </div> <div class="comments" ng-if="footerMode === \'comment\'"> <div class="gridster-container"> <div class="comment col s12" ng-repeat="comment in feedItem.publication.comments"> <div class="comment-image"><img ng-src="{{comment.profile.avatar}}"></div> <div class="comment-body"> <div class="post-author-name"><a href="#">{{comment.poster.displayName}}</a></div> <p ng-bind-html="formatText(comment.content)"></p> </div> </div> </div> </div> <div class="likes" ng-if="footerMode === \'like\'"> <div class="gridster-container"> <div class="comment col s12 m6" ng-repeat="like in feedItem.publication.likes"> <div class="comment-image"><img ng-src="{{like.profile.avatar}}"></div> <div class="comment-body"> <div class="post-author-name"><a href="#">{{like.profile.name}}</a></div> </div> </div> </div> </div> <form class="form-grayed" ng-submit="postComment()"> <textarea style="height: 52px" rows="1" placeholder="Ajouter un commentaire..."></textarea> <button>Envoyer</button> </form> </div> </div> </div> </div>'),a.put("views/main.html",'<div class="view-wrapper main-view-wrapper"> <div class="gridster-container"> <form class="login-form col s12" ng-submit="login()"> <h2>Welcome back !</h2> <input ng-model="formData.login" type="text" placeholder="login" required> <input ng-model="formData.password" type="password" placeholder="password" required> <input type="submit" value="Login"> </form> </div> </div>')}]);